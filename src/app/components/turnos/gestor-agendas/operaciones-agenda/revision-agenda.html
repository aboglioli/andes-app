<form class="plex-layout" #form="ngForm">
  <section *ngIf="showRevisionAgenda">
    <div class="row">
      <div class="col">
        <plex-box>
          <header>
            <div class="clearfix">
              <div class="page-title float-left">Revisión de Agendas</div>
            </div>
            <div class="row">
              <div class="col">
                {{ agenda.horaInicio | date: 'EEE' | uppercase }} {{ agenda.horaInicio | date: 'dd/MM/yyyy'}}, {{ agenda.horaInicio | date: 'HH:mm'}} a {{ agenda.horaFin | date: 'HH:mm'}} hs
                <div *ngFor="let tipoPrestacion of agenda.tipoPrestaciones">{{tipoPrestacion.nombre}}
                </div>
              </div>
            </div>
          </header>
          <table *ngFor="let bloque of agenda.bloques" class="table table-striped">
            <thead *ngIf="bloque.descripcion">
              <tr>
                <th colspan="4">{{bloque.descripcion}}
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let turno of bloque.turnos; let i=index" class="hover" [ngClass]="{'bg-inverse text-white': estaSeleccionado(bloque.turnos[i])}">
                <td (click)="seleccionarTurno(turno, bloque)">
                  <i *ngIf="estaSeleccionado(bloque.turnos[i])" class="mdi mdi-checkbox-marked"></i>
                  <i *ngIf="!estaSeleccionado(bloque.turnos[i])" class="mdi mdi-checkbox-blank-outline"></i>
                </td>
                <td (click)="seleccionarTurno(bloque.turnos[i], bloque)">
                  <strong *ngIf="turno">{{ turno.horaInicio | date: 'HH:mm' }}</strong>
                </td>
                <td (click)="seleccionarTurno(bloque.turnos[i], bloque)">
                  <span *ngIf="turno && turno.paciente">{{ turno.paciente  | paciente }} </span>
                  <small><span *ngIf="turno && turno.paciente">| DNI {{turno.paciente.documento|number}}</span></small>
                  <small><span *ngIf="turno && turno.paciente && turno.paciente.carpetaEfectores && turno.paciente.carpetaEfectores.length>0"> | Nro Carpeta
                      <span *ngFor="let carpeta of turno.paciente.carpetaEfectores | slice:0:1;">
                          {{carpeta.nroCarpeta}}
                            <!-- <plex-text [(ngModel)]="carpeta.nroCarpeta"></plex-text> -->
                      </span>
                  </span></small>
                  <span *ngIf="turno && turno.estado === 'disponible'">Sin asignar</span>
                  <span [ngClass]="{'text-danger': turno.estado === 'turnoDoble'}" *ngIf="turno && turno.estado === 'turnoDoble'">Turno Doble</span>
                  <span [ngClass]="{'text-danger': turno.estado === 'suspendido'}" *ngIf="turno && turno.estado === 'suspendido'">Suspendido</span>
                  <span *ngIf="turno && turno.nota"><i title="{{turno.nota}}" class="text-warning warning mdi mdi-message"></i></span>
                </td>
              </tr>
            </tbody>
          </table>
        </plex-box>
      </div>
      <div *ngIf="turnoSeleccionado && turnoSeleccionado.estado !== 'suspendido' && turnoSeleccionado.estado !== 'turnoDoble'" class="col-9">
        <plex-box>
          <header>
            <div class="row">
              <div class="col">
                <div class="clearfix">
                  <h5>Registros del turno</h5>
                </div>
              </div>
            </div>
          </header>

          <div *ngIf="turnoSeleccionado && turnoSeleccionado.estado == 'disponible'" class="row">
            <div class="col-6" *ngIf="paciente">
              <div *ngIf="paciente"> {{paciente | paciente}}</div>
              <div *ngIf="!turnoSeleccionado.tipoPrestacion && bloqueSeleccionado">
                <br>
                <label>Prestación: </label>
                <plex-select [(ngModel)]="turnoTipoPrestacion" name="tipoPrestacionTurno" [data]="bloqueSeleccionado.tipoPrestaciones">
                </plex-select>
              </div>
            </div>
            <div class="col-6" *ngIf="!pacientesSearch && !showCreateUpdate">
              <plex-button type="primary" icon="mdi mdi-calendar-multiple" label="Buscar Paciente" (click)="buscarPaciente()"></plex-button>
            </div>
            <br>
          </div>

          <div *ngIf="turnoSeleccionado && (turnoSeleccionado.paciente || paciente) && !pacientesSearch && !showCreateUpdate">
            <div class="row">
              <div class="col">
                <label>Asistencia</label>
                <div *ngFor="let estado of estadosAsistencia; let i=index">
                  <td (click)="seleccionarAsistencia(estado)">
                    <i *ngIf="asistenciaSeleccionada(estado)" class="mdi mdi-checkbox-marked"></i>
                    <i *ngIf="!asistenciaSeleccionada(estado)" class="mdi mdi-checkbox-blank-outline"></i>
                  </td>
                  <td (click)="asistenciaSeleccionada(estado)">
                    <strong>{{ estado.nombre }}</strong>
                  </td>
                </div>
              </div>
            </div>
            <br>
            <div *ngIf="turnoSeleccionado && turnoSeleccionado.asistencia == 'asistio'">
            <!--CODIFICACION-->
            <h5>Codificación</h5>
            <h6><strong>Diagnóstico Principal</strong> </h6>
            <plex-bool [(ngModel)]='diagnosticoPrincipal.ilegible' name="ilegible" label="Ilegible" (click)="marcarIlegible()"></plex-bool>
            <div *ngIf="!diagnosticoPrincipal.ilegible">
              <plex-select [(ngModel)]="diagnosticoPrincipal.codificacion" name="searchCodPrincipal" (getData)="buscarCodificacion($event)" placeholder="Seleccione un código CIE10"></plex-select>
              <plex-bool [(ngModel)]='diagnosticoPrincipal.primeraVez' name="primeraVez" label="Primera Vez"></plex-bool>
            </div>
            <label>Otros Diagnósticos</label>
            <div class="row">
              <div class="col-8">
                <plex-select [(ngModel)]="nuevoCodSecundario" name="searchCodSecundario" (getData)="buscarCodificacion($event)" placeholder="Seleccione un ćodigo CIE10"></plex-select>
              </div>
              <plex-button title="Agregar diagnóstico" icon="mdi mdi-plus" type="primary " (click)="agregarDiagnosticoSecundario()"></plex-button>
            </div>
            <div class="list-group">
              <div *ngFor="let diagnostico of turnoSeleccionado.diagnosticoSecundario; let i = index; " class="list-group-item">
                <div class="row">
                  <div class="col-10">
                    {{diagnostico.codificacion.nombre}}
                  </div>
                  <div class="col-2 text-right">
                    <plex-button icon="delete" title="Eliminar" type="danger" (click)="borrarDiagnostico(i)"></plex-button>
                  </div>
                </div>
              </div>
            </div>
          </div>
            <div class="row">
              <div class="col text-right">
                <plex-button label="Cancelar" type="danger" (click)="cancelar()"></plex-button>
                <plex-button label="Guardar" type="success" (click)="onSave()"></plex-button>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col col-sm-12" *ngIf="pacientesSearch">
              <div class="panel panel-default">
                <div class="clear"></div>
                <pacientesSearch (selected)='onReturn($event)'></pacientesSearch>
              </div>
            </div>
            <div class="col col-sm-12" *ngIf="showCreateUpdate">
              <div class="panel panel-default">
                <div class="clear"></div>
                <paciente-create-update [seleccion]="seleccion" [escaneado]="esEscaneado" (data)='afterCreateUpdate($event)'></paciente-create-update>
              </div>
            </div>
          </div>
        </plex-box>
      </div>
    </div>
  </section>
  <footer>
    <div class="row">
      <div class="col text-right">
        <plex-button type="default" label="Volver" (click)="volver()">
        </plex-button>
      </div>
    </div>
    <!--<plex-button title="Clonar Agenda" label="Clonar Agenda" type="primary" (click)="clonar()"></plex-button>-->
  </footer>
</form>
