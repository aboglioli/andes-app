<fieldset *ngIf="autorizado">
    <legend>REASIGNACIÓN | DISPONIBILIDAD DE TURNOS</legend>
    <div *ngIf="agendasCandidatas[0].agendas?.length === 0">
        <i class="mdi mdi-emoticon-sad"></i> No se encontraron Agendas candidatas para la reasignación automática
    </div>
    <div *ngIf="agendasCandidatas?.length > 0 && agendasCandidatas[0].turno">
        <div *ngFor="let agendaCandidata of agendasCandidatas; let indiceTurno = index">
            <plex-accordion class="accordion-reasignar">
                <!--Turno-->
                <div *ngIf="agendaCandidata?.agendas?.length > 0 && agendaCandidata.turno?.reasignado?.siguiente" class="badge-reasignado badge badge-success"><i class="mdi mdi-check"></i></div>
                <div *ngIf="agendaCandidata?.agendas?.length > 0 && !agendaCandidata.turno?.reasignado?.siguiente" class="badge-reasignado badge badge-warning"><i class="mdi mdi-account-convert"></i></div>
                <div *ngIf="agendaCandidata?.agendas?.length === 0 && !agendaCandidata?.turno?.reasignado?.siguiente" class="badge-reasignado badge badge-danger"><i class="mdi mdi-account-alert"></i></div>
                <div>
                    <b>Paciente: </b> {{ agendaCandidata?.turno.paciente | paciente }} | <small>DNI {{ agendaCandidata?.turno.paciente.documento | number }}</small>
                    <br>
                    <b>Turno: </b>{{ agendaCandidata?.turno.horaInicio | date: 'HH:mm' }} hs.
                    <br>
                    <!-- <b>Profesional: </b> -->
                    <!-- <ng-container *ngIf="agendaAReasignar?.profesionales?.length > 0; then hayProfesional else noHayProfesional"></ng-container> -->
                    <!-- <ng-template #hayProfesional>{{ agendaAReasignar?.profesionales[0] | profesional }}</ng-template>
                    <ng-template #noHayProfesional>Sin profesional asignado</ng-template> -->
                </div>
                <plex-panel *ngIf="agendaCandidata?.agendas?.length > 0" tituloPrincipal="Candidatas" icon="arrow-down-drop-circle-outline">
                    <div class="list-group" *ngFor="let agenda of agendaCandidata.agendas; let i = index">

                        <ng-container *ngIf="agendaCandidata.turno?.reasignado?.siguiente; then reasignado else noReasignado"></ng-container>

                        <ng-template #reasignado>
                            <div *ngIf="agenda.agendaReasignada">
                                <!--TODO BOTHO: Hace tu gracia-->
                                <div class="col-12">
                                    <!-- {{agenda.agendaReasignada | json}} -->
                                    Reasignado al Turno: {{ agenda.agendaReasignada?.horaInicio | date: 'EEE' | uppercase }} {{ agenda.agendaReasignada?.horaInicio
                                    | date: 'dd/MM/yyyy'}}, {{ agenda.turnoReasignado?.horaInicio| date: 'HH:mm'}} hs
                                    <div>{{agenda.turnoReasignado?.tipoPrestacion?.nombre}}</div>
                                    <div *ngFor="let profesional of agenda.agendaReasignada?.profesionales">{{profesional | profesional}}</div>
                                </div>
                            </div>
                        </ng-template>

                        <!-- {{getHora(agendaCandidata.turno.horaInicio)}} {{getHora(agendaCandidata.turno.horaInicio) > getHora(hoy)}} -->
                        <ng-template #noReasignado>
                            <!-- <div *ngIf="(getFecha(hoy)===getFecha(agenda.horaInicio) && getHora(agendaCandidata.turno.horaInicio) > getHora(hoy)) || (getFecha(hoy)!==getFecha(agenda.horaInicio)) "> -->
                            <div *ngIf="(getFecha(hoy)===getFecha(agenda.horaInicio) && getHora(agendaCandidata.turno.horaInicio) > getHora(hoy)) || (getFecha(hoy)!==getFecha(agenda.horaInicio)) ">
                                <button *ngIf="agendaCandidata?.agendas?.length > 0" class="btn btn-sm btn-danger float-right hover" (click)="ocultarAgendaCandidata(agenda._id, i)">
                                    <i *ngIf="agendasOcultas[i] === agenda._id" class="mdi mdi-eye"></i>
                                    <i *ngIf="agendasOcultas[i] !== agenda._id" class="mdi mdi-eye-off"></i>
                                </button>
                            </div>
                            <div *ngIf="(getFecha(hoy)===getFecha(agenda.horaInicio) && getHora(agendaCandidata.turno.horaInicio) > getHora(hoy)) || (getFecha(hoy)!==getFecha(agenda.horaInicio)) ">
                                <a class="list-group-item list-group-item-action flex-column align-items-start hover" (click)="seleccionarCandidata(indiceTurno, i)"
                                    [hidden]="agendasOcultas[i] === agenda._id">
                                    <div class="d-flex w-100 justify-content-between">
                                        <h5 class="mb-1">{{ agenda.horaInicio | date: 'EEEE' }} {{ agenda.horaInicio | date: 'dd/MM/yyyy'
                                            }}
                                            <i class="mdi mdi-clock"></i> {{ agendaCandidata.turno.horaInicio | date:'HH:mm'}}
                                            hs.
                                        </h5>
                                        <small>{{ agenda.similitud }}%</small>
                                    </div>
                                    <p class="mb-1">
                                        Tipo Prestación: {{ agendaCandidata.turno.tipoPrestacion.nombre }}
                                    </p>
                                    <small *ngIf="agenda.profesionales?.length > 0">Profesional: {{ agenda.profesionales[0] | profesional }}</small>
                                </a>
                            </div>
                        </ng-template>
                        <hr>
                    </div>
                </plex-panel>
                <hr>
            </plex-accordion>
        </div>
    </div>
    <hr>
    <div *ngIf="agendasCandidatas.agendas?.length > 0">
        <plex-button type="primary" label="Reasignación de Turnos" (click)="reasignarTurnos()"></plex-button>
    </div>
</fieldset>
