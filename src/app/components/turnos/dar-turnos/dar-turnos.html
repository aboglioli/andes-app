<div class="row" *ngIf="showDarTurnos">
  <div class="col-md-8">
    <div class="row">
      <div class="col-md-12">
        <plex-box>
          <div class="row">
            <div class="col-md-12">
              <plex-button icon="account-plus" (click)="buscarPaciente()" title="Buscar Paciente" label="Buscar Paciente" type="info"></plex-button>                            
            </div>
            <div class="col-md-4">
              <plex-select [(ngModel)]="opciones.prestacion" (get-data)="loadPrestaciones($event)" label="Prestaciones" (change)="filtroPrestacion()">
              </plex-select>
            </div>
            <div class="col-md-4">
              <plex-select [(ngModel)]="opciones.profesional" (get-data)="loadProfesionales($event)" label="Profesionales" label-field="nombre + ' ' + apellido"
                (change)="actualizar('')">
              </plex-select>
            </div>
            <div class="col-md-1">
              <label>&nbsp;</label>
              <plex-button icon="eraser" (click)="actualizar('sinFiltro')"></plex-button>
            </div>
            <div class="col-md-3" text-align="center">
              <h4>
                <plex-button type="link" icon="chevron-left" (click)="cambiarMes('-')"></plex-button>
                {{ opciones.fecha | date: "MMM yy" | uppercase}}
                <plex-button type="link" icon="chevron-right" (click)="cambiarMes('+')"></plex-button>
              </h4>
            </div>
          </div>
        </plex-box>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
        <calendario [agendas]="agendas" [fecha]="opciones.fecha" [agenda]="agenda" [estado]="estado" (agenda-changed)="seleccionarAgenda($event)"></calendario>
      </div>
    </div>
  </div>
  <div type="info" class="col-md-4">
    <plex-tabs>
      <plex-tab icon="account">
        <div class="row">
          <div *ngIf="estadoT=='seleccionada'" class="col-md-12">
            <div class="row">
              <div class="col-md-8" align="center">
                <div class="box">
                  <div class="box-content" align="center">
                    <h1>
                      <small> 
                            <div *ngFor="let profesional of agenda.profesionales let i=index">
                                <div *ngIf="i<agenda.profesionales.length-1">
                                    {{profesional.nombre}} {{profesional.apellido}},
                                </div>
                                <div *ngIf="i>=agenda.profesionales.length-1">
                                    {{profesional.nombre}} {{profesional.apellido}}
                                </div>
                            </div>
                        </small>
                      <br>
                      <plex-button type="link" icon="chevron-left" (click)="verAgenda(false)"></plex-button>
                      {{agenda.horaInicio | date: 'dd/MM'}}
                      <plex-button type="link" icon="chevron-right" (click)="verAgenda(true)"></plex-button>
                      <br><br>
                      <small>{{semana[agenda.horaInicio.getDay()]}}</small><br>
                    </h1>
                    <br>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-8">
                <plex-box>
                  <div *ngFor="let bloque of bloques; let indiceBq=index">
                    <div class="row">
                      <div *ngIf="bloque.turnos.length" class="col-md-12">
                        <h2>
                          <small>
                                <span>{{bloque.descripcion}}</span>  <span class="badge"> {{bloque.duracionTurno}} '</span>
                            </small>
                        </h2>
                      </div>
                    </div>
                    <div *ngFor="let turno of bloque.turnos; let i=index">
                      <div *ngIf="turno.estado == 'disponible'" class="row">
                        <div class="col-md-12">
                          <a class="hover" (click)="seleccionarTurno(bloque,i)">{{turno.horaInicio | date: 'HH:mm'}}</a>
                        </div>
                      </div>
                      <br *ngIf="turno.estado == 'disponible'">
                    </div>
                  </div>
                </plex-box>
              </div>
            </div>
            <div class="row">
              <div class="col-md-12">
                <plex-button title="No se asigna turno" label="No se asigna turno" type="danger"></plex-button>
              </div>
            </div>
          </div>
          <div *ngIf="estadoT=='noSeleccionada'" class="col-md-12">
            <plex-box title="Ultimas Búsquedas">
              <div class="row">
                <div class="col-md-12">
                  <label>Profesional: &nbsp;</label> <span>Horacio Marconi </span><br>
                  <label>Prestación: &nbsp;</label> <span>{{cachePrestacion}} </span><br>
                  <label>Profesional: &nbsp;</label> <span>Jorge Perez &nbsp;</span><label>Prestación: &nbsp;</label> <span>Cardiología adultos </span><br>
                </div>
              </div>
            </plex-box>
            <div class="row">
              <div class="col-md-12">
                <plex-button title="No se asigna turno" label="No se asigna turno" type="danger"></plex-button>
              </div>
            </div>
          </div>
          <div *ngIf="estadoT=='noTurnos'" class="col-md-12">
            <div class="row">
              <div class="col-md-8" align="center">
                <div class="box">
                  <div class="box-content" align="center">
                    <h1>
                      <small> 
                            <div *ngFor="let profesional of agenda.profesionales let i=index">
                                <div *ngIf="i<agenda.profesionales.length-1">
                                    {{profesional.nombre}} {{profesional.apellido}},
                                </div>
                                <div *ngIf="i>=agenda.profesionales.length-1">
                                    {{profesional.nombre}} {{profesional.apellido}}
                                </div>
                            </div>
                        </small>
                      <br>
                      <plex-button type="link" icon="chevron-left" (click)="verAgenda(false)"></plex-button>
                      {{agenda.horaInicio | date: 'dd/MM'}}
                      <plex-button type="link" icon="chevron-right" (click)="verAgenda(true)"></plex-button>
                      <br><br>
                      <small>{{semana[agenda.horaInicio.getDay()]}}</small><br>
                    </h1>
                    <br>
                  </div>
                </div>
              </div>
            </div>
            <plex-box title="Alternativas">
              <div class="row">
                <div class="col-md-12">
                  <label>Alternativa 1: &nbsp;</label> <span>Juan Gomez 29/12/2016 </span><br>
                  <label>Alternativa 2: &nbsp;</label> <span>Pepe Mujica 03/01/2017 </span><br>
                </div>
              </div>
            </plex-box>
            <div class="row">
              <div class="col-md-12">
                <plex-button title="No se asigna turno" label="No se asigna turno" type="danger"></plex-button>
              </div>
            </div>
          </div>
          <div *ngIf="estadoT=='confirmacion'" class="col-md-12">
            <plex-box type="warning" title="Confirmar Turno">
              <div class="row">
                <div class="col-md-12">
                  <div class="col-md-12"><label>Paciente: &nbsp;</label>{{this.paciente.nombre}} {{this.paciente.apellido}} ({{this.paciente.documento}})</div>
                  <div class="col-md-12"><label>Teléfono: &nbsp;</label><input value="{{telefono}}"></div>
                  <br><br>
                  <div class="col-md-6"><br><label>Fecha: &nbsp;</label>{{agenda.horaInicio | date: 'dd/MM/yyyy'}}</div>
                  <div class="col-md-6"><br><label>Hora: &nbsp;</label>{{turno.horaInicio | date: 'HH:mm'}}</div>
                  <div class="col-md-12"><br><label>Profesionales: </label>
                    <div *ngFor="let profesional of agenda.profesionales let i=index">
                      <div *ngIf="i<agenda.profesionales.length-1">
                        {{profesional.nombre}} {{profesional.apellido}},
                      </div>
                      <div *ngIf="i>=agenda.profesionales.length-1">
                        {{profesional.nombre}} {{profesional.apellido}}
                      </div>
                    </div>
                  </div>
                  <div class="col-md-12">
                    <br>
                    <label>Prestaciones: </label>
                    <div *ngFor="let prestacion of bloque.prestaciones let j=index">
                      <div *ngIf="j<bloque.prestaciones.length-1">
                        {{prestacion.nombre}},
                      </div>
                      <div *ngIf="j>=bloque.prestaciones.length-1">
                        {{prestacion.nombre}}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <br>
              <div class="row">
                <div class="col-md-3">
                  <plex-button title="Confirmar" label="Confirmar" type="primary" (click)="onSave()"></plex-button>
                </div>
                <div class="col-md-3">
                  <plex-button title="Volver" label="Volver" type="default" (click)=" actualizar('')"></plex-button>
                </div>
              </div>
            </plex-box>
          </div>
        </div>
        <!--<turnos-agendas [agendas]="agendas" [agenda]="agenda" (agenda-changed)="seleccionarAgenda($event)"></turnos-agendas>-->
      </plex-tab>
      <plex-tab icon="history">
        <plex-box>
          TODO: INFO DEL PACIENTE
        </plex-box>
      </plex-tab>
      <plex-tab icon="pencil">
        <plex-box>
          TODO: EDITAR PACIENTE
        </plex-box>
      </plex-tab>
    </plex-tabs>
  </div>
</div>


<div class="col-sm-12" *ngIf="pacientesSearch">
  <div class="panel panel-default">
    <div class="clear"></div>
    <pacientesSearch (selected)='onReturn($event)'></pacientesSearch>
  </div>
</div>