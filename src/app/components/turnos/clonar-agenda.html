<section>
  <div class="row">
    <div class="col" text-align="center">
      <h4>
        <plex-button type="link" icon="chevron-left" (click)="cambiarMes('-')"></plex-button>
        {{ fecha | date: "MMM yy" | uppercase}}
        <plex-button type="link" icon="chevron-right" (click)="cambiarMes('+')"></plex-button>
      </h4>
    </div>
  </div>
  <div class="row">
    <div class="col-8">
      <plex-box>
        <table *ngIf="calendario" class="table table-striped">
          <tr *ngFor="let week of calendario">
            <td *ngFor="let day of week" class="text-center" [ngClass]="{'bg-primary text-white': (day.estado == 'seleccionado') && (day.original == false),
            'bg-success success': day.original == true ,'hover': day.fecha.getTime() >= hoy.getTime()}" (click)="seleccionar(day)"
              style="width: 50px; height: 80px">
              <div>{{ day.fecha | date:"d" }}</div>
              <div>{{ day.fecha | date:"EEE" | uppercase }}</div>
              <div>
                <i *ngIf="day.seleccionado" class="mdi mdi-check-circle"></i>
                <i *ngIf="(!day.seleccionado) && (day.estado == 'disponible')" class="mdi mdi-plus-box"></i>
                <i *ngIf="(!day.seleccionado) && (day.estado == 'ocupado')" class="mdi mdi-close-box"></i>
              </div>
            </td>
          </tr>
        </table>
      </plex-box>
    </div>
    <div class="col">
      <plex-box>
        <header>Agenda Original</header>
        <div class="row">
          <div class="col-12">
            <span><b>Fecha:</b> {{agenda.horaInicio | date: 'dd/MM/yyyy'}} - {{agenda.horaInicio | date: 'HH:mm'}} - {{agenda.horaFin | date: 'HH:mm'}}</span>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <b>Profesional: </b><span *ngFor="let profesional of agenda.profesionales">{{profesional.nombre}} {{profesional.apellido}} - </span>
            <br /><b>Prestaciones: </b><span *ngFor="let prestacion of agenda.prestaciones">{{prestacion.nombre}} - </span>
            <br /><b>Espacio Físico: </b><span>{{agenda.espacioFisico?agenda.espacioFisico.nombre:''}}</span>
          </div>
        </div>
        <div class="row">
          <label>Bloques</label>
          <template ngFor let-unBloque="$implicit" [ngForOf]="agenda.bloques" let-i="index">
            <div class="col-4">{{unBloque.descripcion}}</div>
            <div class="col-4">{{unBloque.titulo}}</div>
            <div class="col-4">{{unBloque.cantidadTurnos}} turnos de {{unBloque.duracionTurno}}'</div>
          </template>

        </div>
        <div *ngIf="agendasFiltradas.length>0">
          <hr>
          <header>Agendas en conflicto</header>
          <plex-accordion>
            <template ngFor let-agendaF="$implicit" [ngForOf]="agendasFiltradas" let-i="index">
              <plex-panel tituloPrincipal="{{agendaF.horaInicio | date: 'dd/MM/yyyy hh:mm'}}">
                <li *ngIf="agendaF.conflictoEF">
                  Conflicto con Espacio Físico
                </li>
                <li *ngIf="agendaF.conflictoProfesional">
                  Conflicto con Profesionales
                </li>
              </plex-panel>
            </template>
          </plex-accordion>
        </div>
      </plex-box>
    </div>

  </div>
  <!--<pre> Seleccionados {{seleccionados.length}}</pre>
  <pre> Filtradas {{agendasFiltradas.length}}</pre>-->
</section>
<footer>
  <plex-button title="Clonar Agenda" label="Clonar Agenda" type="primary" (click)="clonar()"></plex-button>
  <plex-button title="Cancelar" label="Cancelar" (click)="cancelar()"></plex-button>
</footer>
