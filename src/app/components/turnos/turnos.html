<div class="row" style="" *ngIf="showTurnos">
    <div class="col-12">
        <strong class="h4">Turnos: {{agenda.horaInicio | date: 'dd/MM/yyyy'}}</strong>
    </div>
    <div class="col-12">
        <div *ngIf="cantSel === 0" style="height: 38px"></div>
        <div *ngIf="cantSel > 0">
            <!--<div class="botonera-turnos" *ngIf="!botones.asistencias"></div>-->
            <button *ngIf="botones.sacarAsistencia" id="sacarAsistencia" class="btn btn-default hover" (click)="eventosTurno(agenda, $event)">
                <span><i title="Sacar Asistencia" class="mdi mdi-account-remove"></i></span>
            </button>
            <button *ngIf="botones.darAsistencia" id="darAsistencia" class="btn btn-default hover" (click)="eventosTurno(agenda, $event)">
                <span><i title="Dar Asistencia" class="mdi mdi-account-check"></i></span>
            </button>
            <span *ngIf="botones.suspenderTurno">
                <button id="suspenderTurno" class="btn btn-default hover" mwlConfirmationPopover [title]="titleSuspenderTurno" [message]="messageSuspenderTurno"
                    placement="bottom" (confirm)="suspenderTurno(agenda, confirmaSuspenderTurno = true)"
                    (cancel)="cancelClicked = true" confirmText="Confirmar" cancelText="Cancelar">
                    <i title="Suspender Turno" class="mdi mdi-power"></i>
                </button>
                <!--<i *ngIf="botones.suspenderTurnoDeshabilitado" title="No es posible suspender el Turno" class="text-info info mdi mdi-select"></i>-->
            </span>
            <span *ngIf="botones.liberarTurno">
                <button id="liberarTurno" class="btn btn-default hover" mwlConfirmationPopover [title]="titleLiberarTurno" [message]="messageLiberarTurno"
                    placement="bottom" (confirm)="liberarTurno(agenda, confirmaLiberarTurno = true)"
                    (cancel)="cancelClicked = true" confirmText="Confirmar" cancelText="Cancelar">
                    <i title="Liberar Turno" class="mdi mdi-account-plus"></i>
                </button>
                <!--<i *ngIf="turno.botones.liberarTurnoDeshabilitado" title="No es posible Liberar el Turno" class="mdi mdi-select"></i>-->
            </span>
            <span *ngIf="botones.bloquearTurno">
                <button id="bloquearTurno" class="btn btn-default hover" (click)="eventosTurno(agenda, $event)">
                    <i title="Desbloquear Turno" class="mdi mdi-lock-open-outline"></i>
                </button>
            </span>
            <span *ngIf="botones.desbloquearTurno">
                <button id="BloquearTurno" class="btn btn-default hover" (click)="eventosTurno(agenda, $event)">
                    <i title="Bloquear Turno" class="mdi mdi-lock-outline"></i>
                </button>
                <!--<i *ngIf="turno.botones.bloquearTurnoDeshabilitado" title="No es posible bloquear el Turno" class="mdi mdi-select"></i>-->
            </span>
            <span *ngIf="botones.tdReasignarTurno">
                <button class="btn btn-default hover">
                    <i title="Reasignar Turno" (click)="reasignarTurno(turno.paciente, turno.id, agenda.id)" class="mdi mdi-backup-restore"></i>
                </button>
                <!--<i *ngIf="turno.botones.reasignarTurnoDeshabilitado" title="No es posible reasignar Turno" class="mdi mdi-select"></i>-->
            </span>
            <span *ngIf="botones.tdNota">
                <button class="btn btn-default hover" (click)="agregarNotaTurno(agenda)"><i title="Agregar Nota" class="mdi mdi-message-text-outline"></i></button>
            </span>

            <span class="col-md-5" *ngIf="agenda.estado == 'Suspendida'">
                <button class="btn btn-default hover" (click)="enviarSMS()"><i title="Enviar SMS" class="mdi mdi-email-outline"></i></button>
                <button class="btn btn-default hover" (click)="agregarPacienteListaEspera(agenda)"><i title="Agregar Paciente a Lista Espera" class="mdi mdi-account-alert"></i></button>
                <!--<plex-bool name="seleccionar" [(ngModel)]="selectAll"></plex-bool>-->
                <!--<a class="hover" (click)="reasignarTurnosMasivo()"><i title="Reasignar Turno Masivo" class="mdi mdi-rotate-right"></i></a>-->
            </span>

        </div>
            <template ngFor let-bloque="$implicit" [ngForOf]="agenda.bloques" let-i="index">
        <table *ngIf="agenda" class="table" >
            Turnos: {{ this.turnos.length }}
            Seleccionados: {{ this.turnosSeleccionados.length }}
            <!--turno: {{ this.turnosSeleccionados[0] | json }}-->
            botones.darAsistencia: {{ botones.darAsistencia }}
            turnoEstado: {{ this.turnosSeleccionados[0]?.estado | json }}
            Paciente: {{ this.turnosSeleccionados[0]?.paciente?.length }}
                <tr>
                    <td colspan="3">
                        <strong>Bloque: </strong>{{bloque.descripcion}}
                    </td>
                    <td colspan="1">
                        <input type="checkbox" [ngModel]="todos" (click)="seleccionarTodos()">
                    </td>
                </tr>
        </table>
        <table class="table table-striped">
                <tr *ngFor="let turno of bloque.turnos; let i=index" [ngClass]="{'text-success': turno.paciente && turno.estado !== 'bloqueado'}">
                    <td>
                        <strong>{{ turno.horaInicio | date: 'HH:mm' }}</strong>
                    </td>
                    <td>
                        <span *ngIf="turno.paciente">{{ turno.paciente.apellido }} {{ turno.paciente.nombre }} </span>
                        <span *ngIf="turno.estado === 'disponible'">Disponible</span>
                        <span *ngIf="turno.estado === 'bloqueado'" [ngClass]="{'text-danger': turno.estado === 'bloqueado'}">No Disponible</span>
                        <span *ngIf="turno.nota" ><i title="{{turno.nota}}" class="text-warning warning mdi mdi-message"></i></span>
                    </td>
                    <td>
                        <label *ngIf="turno.asistencia && turno.paciente">Tiene Asistencia</label>
                        <label *ngIf="!turno.asistencia && turno.paciente && turno.estado !== 'bloqueado'">No Tiene Asistencia</label>
                        <label *ngIf="!turno.paciente">({{ turno.estado }})</label>
                    </td>
                    <td class="text-center" *ngIf="turno.botones?.smsVisible">
                        <i *ngIf="turno.botones.smsNoEnviado" title="SMS No Enviado" class="text-danger danger mdi mdi-checkbox-blank-circle-outline"></i>
                        <i *ngIf="turno.botones.smsEnviado" title="SMS Enviado" class="text-success success mdi mdi-checkbox-marked-circle-outline"></i>
                        <div>
                            <plex-loader *ngIf="turno.botones.smsLoader" type="ball-pulse"></plex-loader>
                        </div>
                    </td>
                    <td colspan="1">
                        <input type="checkbox" [ngModel]="turno.checked" (click)="seleccionarTurno(turno)">
                    </td>
                </tr>
        </table>
            </template>
    </div>
</div>

<!-- Muestra el panel de Liberar turno -->
<div type="info" class="col-md-12" *ngIf="showLiberarTurno">
    <div class="clear"></div>
    <liberar-turno [agenda]="agenda" [turnosSeleccionados]="turnosSeleccionados" (saveLiberarTurno)="saveLiberarTurno($event)"
        (reasignarTurnoLiberado)="reasignarTurnoLiberado($event)"></liberar-turno>
</div>

<!-- Muestra el panel de Suspender turno -->
<div type="info" class="col-md-12" *ngIf="showSuspenderTurno">
    <div class="clear"></div>
    <suspender-turno [agenda]="agenda" [turnosSeleccionados]="turnosSeleccionados" (saveSuspenderTurno)="saveSuspenderTurno($event)"
        (reasignarTurnoSuspendido)="reasignarTurnoSuspendido($event)"></suspender-turno>
</div>

<!-- Muestra el panel de Nota -->
<div type="info" class="col-md-12" *ngIf="showAgregarNotaTurno">
    <div class="clear"></div>
    <agregar-nota-turno [agenda]="agenda" [turnosSeleccionados]="turnosSeleccionados" (saveAgregarNotaTurno)="saveAgregarNotaTurno($event)"
        (cancelaAgregarNota)="cancelaAgregarNota($event)"></agregar-nota-turno>
</div>