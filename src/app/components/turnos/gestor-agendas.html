<section *ngIf="autorizado && showGestorAgendas" [formGroup]="searchForm">
    <div class="row">
      <div class="col-9">
        <plex-box>
          <header>
            <div class="row">
              <div class="col-2">
                <plex-datetime type="date" formControlName="fechaDesde" placeholder="Fecha Desde" class="fechas">
                </plex-datetime>
              </div>
              <div class="col-2">
                <plex-datetime type="date" formControlName="fechaHasta" placeholder="Fecha Hasta">
                </plex-datetime>
              </div>
              <div class="col-2">
                <plex-select formControlName="prestaciones" (getData)="loadPrestaciones($event)" placeholder="Tipo Prestación">
                </plex-select>
              </div>
              <div class="col-2">
                <plex-select formControlName="profesionales" (getData)="loadProfesionales($event)" placeholder="Profesional" labelField="nombre+' '+apellido">
                </plex-select>
              </div>
              <div class="col-2">
                <plex-select formControlName="espacioFisico" (getData)="loadEspaciosFisicos($event)" placeholder="Espacio físico">
                </plex-select>
              </div>
              <div class="col-2">
                <plex-select formControlName="estado" (getData)="loadEstados($event)" placeholder="Estado">
                </plex-select>
              </div>
            </div>
          </header>
          <div>
            <span class="h4" *ngIf="agendas.length && hoy">Agendas de hoy</span>
            <span class="h4" *ngIf="agendas.length && !hoy">Agendas</span>
            <div *ngIf="!showVistaAgendas"> </div>
            <vista-agenda class="float-right" *ngIf="agendasSeleccionadas.length > 0" [vistaAgenda]="agenda" [agendasSeleccionadas]="agendasSeleccionadas"
            (clonarEmit)="clonar($event)" (editarAgendaEmit)="editarAgenda($event)" (actualizarEstadoEmit)="actualizarEstadoEmit($event)"></vista-agenda>
            <table class="table table-striped">
                <thead>
                </thead>
                <tbody>
                    <tr *ngFor="let agenda of agendas; let i = index" class="row text-center" style="cursor: pointer; pointer-events: all" [ngClass]="{'bg-primary text-white': estaSeleccionada(agenda)}">
                        <td class="col-1" (click)="verAgenda(agenda, true, $event)">
                          <i *ngIf="estaSeleccionada(agenda)" class="mdi mdi-check-circle" [ngClass]="{'text-success': estaSeleccionada(agenda)}"></i>
                          <i *ngIf="!estaSeleccionada(agenda)" class="mdi mdi-checkbox-blank-circle-outline"></i>
                        </td>
                        <td class="col-3" (click)="verAgenda(agenda, false, $event)">{{agenda.horaInicio | date: 'dd/MM/yyyy'}} {{agenda.horaInicio | date: 'HH:mm'}} a {{agenda.horaFin | date:
                        'HH:mm'}} horas.</td>
                        <template [ngIf]="agenda.tipoPrestaciones">
                        <td class="col-3" (click)="verAgenda(agenda, false, $event)"><span *ngFor="let tipoPrestacion of agenda.tipoPrestaciones">{{tipoPrestacion.nombre}}</span></td>
                        </template>
                        <template [ngIf]="agenda.profesionales">
                        <td class="col" (click)="verAgenda(agenda, false, $event)">
                            <span *ngIf="agenda.profesionales?.length == 0" class="text-danger">sin profesional asignado</span>
                            <span *ngFor="let profesional of agenda.profesionales">{{profesional.nombre}} {{profesional.apellido}} </span>
                        </td>
                        </template>
                        <td class="col" (click)="verAgenda(agenda, false, $event)">
                            <span>{{agenda?.espacioFisico?.nombre}}</span>
                            <span *ngIf="!agenda.espacioFisico?.nombre" class="text-danger">sin espacio asignado</span>
                        </td>
                        <td class="col" (click)="verAgenda(agenda, false, $event)"><span>{{agenda?.estado}}</span></td>
                    </tr>
                </tbody>
            </table>
          </div>
        </plex-box>
      </div>
      <div class="col-3">
        <plex-box>
          <div *ngIf="showTurnos && agendasSeleccionadas.length == 1" type="info">
            <turnos [agenda]="agendasSeleccionadas[0]" (reasignaTurno)="reasignaTurno($event)"></turnos>
          </div>

          <div *ngIf="showEditarAgendaPanel && agendasSeleccionadas.length == 1" type="info">
            <panel-agenda [editaAgendaPanel]="vistaAgenda" (showVistaTurnos)="showVistaTurnos($event)"></panel-agenda>
          </div>
        </plex-box>
      </div>
    </div>
</section>

<footer>
  <plex-button type="primary" icon="mdi mdi-plus-box" label="Crear Agenda" (click)="redirect('agenda')"></plex-button>
  <plex-button type="primary" icon="mdi mdi-calendar-multiple" label="Dar Turnos" (click)="redirect('turnos')"></plex-button>
</footer>

<!--<plex-box type="footer">
    <plex-button type="primary" icon="mdi mdi-plus-box" label="Crear Agenda" (click)="redirect('agenda')"></plex-button>
    <plex-button type="primary" icon="mdi mdi-calendar-multiple" label="Dar Turnos" (click)="redirect('turnos')"></plex-button>
  </plex-box>-->

<clonar-agenda *ngIf="showClonar" [agenda]="modelo" (cancelaClonar)="cancelaClonar($event)"></clonar-agenda>
<dar-turnos *ngIf="showDarTurnos" [reasignar]="reasignar" (cancelaDarTurnos)="cancelaDarTurnos($event)"></dar-turnos>
<agenda *ngIf="showEditarAgenda" [editaAgenda]="vistaAgenda" (cancelaEditar)="cancelaEditar($event)"></agenda>
