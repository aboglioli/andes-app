<header *ngIf="prestacion">
    <header-paciente [paciente]="prestacion.paciente" [prestacion]="prestacion"></header-paciente>
</header>

<section class="plex-layout prestacionEjecucion" *ngIf="prestacion && elementoRUPprestacion">

    <div class="row">
        <div class="col-3">
            <rup-hudsBusqueda [paciente]="prestacion?.paciente" [prestacionActual]="prestacion?.id" [_dragScope]="'registros-rup'" (evtData)="ejecutarConceptoHuds($event)" (_onDragStart)="arrastrandoConcepto(true)" (_onDragEnd)="arrastrandoConcepto(false)"></rup-hudsBusqueda>
        </div>
        <div class="col-6">
            <plex-box>
                <header>
                    <div class="clearfix">
                        <div class="page-title">
                            {{prestacion.solicitud.tipoPrestacion.term}}
                        </div>
                    </div>
                </header>

                <div droppable [dropScope]="'registros-rup'" [dragOverClass]="'drag-target-border'" (onDrop)="onConceptoDrop($event)" class="droppable drop-area" [hidden]="!isDraggingConcepto">
                     <p>
                        Arrastre aqu√≠ para vincularlos a esta consulta
                    </p>
                </div>



                <div *ngIf="registros && registros.length">
                    <ng-container *ngFor="let elemento of registros; let i = index">

                        <div droppable [dropScope]="'orden-registros-rup'" (onDrop)="moverRegistro(i, $event)"
                            [dragOverClass]="'drag-hover-line'"
                            class="drop-line-area" >
                        </div>

                        <div droppable [dropScope]="'vincular-registros-rup'" (onDrop)="vincularRegistros($event, elemento)"
                            [dragOverClass]="'drag-target-border'"
                            [ngClass]="{'relacionado': elemento.relacionadoCon}" >

                            <div class="rup-card" *ngIf="elemento.elementoRUP"
                                draggable
                                [dragScope]="['orden-registros-rup', 'vincular-registros-rup']"
                                [dragOverClass]="'drag-target-border'" [dragData]="elemento" >

                                <div class="type {{elemento.tipo}} drag-handle">
                                    <i  class="drag-orden mdi mdi-drag-vertical" aria-hidden="true"></i>
                                </div>

                                <div class="rup-content">
                                    <div class="header">
                                        <div class="title">
                                            {{elemento.concepto.term}}
                                        </div>

                                        <div class="actions">
                                            <a href="javascript:void(0);" (click)="elementosRUPcollapse[i] = !elementosRUPcollapse[i]">

                                                <i class="mdi mdi-chevron-down" [ngClass]="{'spin' : elementosRUPcollapse[i]}"></i>
                                            </a>
                                        </div>
                                    </div>

                                    <div class="rup-body " [hidden]="elementosRUPcollapse[i]">
                                        <rup #rup [prestacion]="prestacion" [elementoRUP]="elemento.elementoRUP" [paciente]="prestacion.paciente" [conceptoSnomed]="elemento.concepto" (evtData)="getValoresRup($event, elemento.elementoRUP)" *ngIf="elemento.concepto.semanticTag == 'trastorno'
                                                || elemento.concepto.semanticTag == 'hallazgo' || elemento.concepto.semanticTag == 'procedimiento'">
                                        </rup>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-container>

                    <div droppable [dropScope]="'orden-registros-rup'" (onDrop)="moverRegistro(registros.length, $event)"
                        [dragOverClass]="'drag-hover-line'"
                        class="drop-line-area" *ngIf="registros && registros.length">
                    </div>
                </div>
            </plex-box>
        </div>

        <div class="col-3">
            <plex-box>
                <header>
                    <div class="clearfix">
                        <div class="page-title">
                            Buscador
                        </div>
                    </div>
                </header>

                <div class="row">
                    <div class="col">

                        <rup-buscador (evtData)="ejecutarConcepto($event)" [elementoRUPpretacion]="elementoRUPprestacion" (_tipoDeBusqueda)="recibeTipoBusqueda($event)" (_onDragStart)="arrastrandoConcepto(true)" (_onDragEnd)="arrastrandoConcepto(false)"></rup-buscador>

                    </div>
                </div>
            </plex-box>
        </div>
    </div>
</section>

<!--
<footer>
    <div class="row">
        <div class="col-3">
            <plex-button title="Volver" icon="mdi mdi-arrow-left-bold" label="volver" (click)="volver('rup/resumen')" type="danger"></plex-button>
        </div>
        <div class=" col-6 text-center">
            <div *ngIf="error !=0 " class="alert alert-danger " role="alert">
                {{error}}
            </div>
        </div>
        <div class="col-3 text-right ">
            <plex-button title="Guardar " label="Guardar " (click)="guardarPrestacion()" type="success"></plex-button>
        </div>
    </div>
</footer>
-->
